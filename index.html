<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Or√ßamento Pessoal</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background-color: white;
            color: #1f2937;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .modal {
            display: none;
        }
        .modal.active {
            display: flex;
        }
        
        /* Garantir que os gr√°ficos sejam responsivos */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Melhorar a apar√™ncia em dispositivos m√≥veis */
        @media (max-width: 768px) {
            .chart-container {
                height: 250px;
            }
            
            .container {
                padding: 1rem;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Anima√ß√µes suaves */
        .tab-button {
            transition: all 0.2s ease;
        }
        
        .modal {
            transition: opacity 0.2s ease;
        }
        
        /* Garantir que os elementos sejam clic√°veis */
        button {
            cursor: pointer;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        /* Melhorar contraste */
        .text-gray-500 {
            color: #6b7280;
        }
        
        .text-gray-600 {
            color: #4b5563;
        }
        
        .text-gray-700 {
            color: #374151;
        }

        /* Estilos para checkbox customizado */
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .checkbox-custom {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .checkbox-custom.checked {
            background-color: #10b981;
            border-color: #10b981;
            color: white;
        }

        .checkbox-custom:hover {
            border-color: #10b981;
        }

        /* Bot√µes de a√ß√£o */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-edit {
            background-color: #3b82f6;
            color: white;
        }

        .btn-edit:hover {
            background-color: #2563eb;
        }

        .btn-delete {
            background-color: #ef4444;
            color: white;
        }

        .btn-delete:hover {
            background-color: #dc2626;
        }

        /* Linha riscada para itens pagos */
        .item-pago {
            opacity: 0.7;
        }

        .item-pago .item-titulo {
            text-decoration: line-through;
        }

        /* Status de sincroniza√ß√£o */
        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .sync-status.success {
            background-color: #10b981;
            color: white;
        }

        .sync-status.error {
            background-color: #ef4444;
            color: white;
        }

        .sync-status.loading {
            background-color: #3b82f6;
            color: white;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Status de Sincroniza√ß√£o -->
    <div id="sync-status" class="sync-status" style="display: none;"></div>

    <div class="container mx-auto p-4 md:p-6 space-y-6 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900">üí∞ Or√ßamento Pessoal</h1>
            <p class="text-gray-600 mt-2">Controle suas finan√ßas de forma inteligente</p>
            <div class="mt-4 flex justify-center gap-4">
                <button onclick="sincronizarDados()" class="bg-green-600 text-white hover:bg-green-700 py-2 px-4 rounded-md text-sm font-medium flex items-center gap-2">
                    <span>‚òÅÔ∏è</span>
                    Sincronizar com Google Sheets
                </button>
                <button onclick="openModal('modal-configuracao')" class="bg-gray-600 text-white hover:bg-gray-700 py-2 px-4 rounded-md text-sm font-medium flex items-center gap-2">
                    <span>‚öôÔ∏è</span>
                    Configura√ß√µes
                </button>
            </div>
        </div>

        <!-- Alertas de Vencimento -->
        <div id="alertas-container" class="hidden">
            <div class="border border-orange-200 bg-orange-50 rounded-lg p-4">
                <div class="flex items-start gap-2">
                    <span class="text-orange-600 text-xl">‚ö†Ô∏è</span>
                    <div class="flex-1">
                        <h4 class="font-semibold text-orange-800">Contas pr√≥ximas do vencimento!</h4>
                        <div id="alertas-lista" class="mt-2 space-y-1 text-sm text-orange-700"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="w-full">
            <div class="flex bg-gray-100 p-1 rounded-lg mb-6">
                <button class="tab-button active flex-1 py-2 px-4 text-sm font-medium rounded-md transition-all" onclick="showTab('dashboard')">
                    üìä Dashboard
                </button>
                <button class="tab-button flex-1 py-2 px-4 text-sm font-medium rounded-md transition-all" onclick="showTab('extrato')">
                    üìà Extrato
                </button>
                <button class="tab-button flex-1 py-2 px-4 text-sm font-medium rounded-md transition-all" onclick="showTab('contas')">
                    üìã Contas
                </button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active space-y-6">
                <!-- Resumo Financeiro -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-medium text-gray-700">Total Receitas</h3>
                            <span class="text-green-600 text-xl">üìà</span>
                        </div>
                        <div id="total-receitas" class="text-xl md:text-2xl font-bold text-green-600 mb-1">R$ 0,00</div>
                        <p id="receitas-realizadas" class="text-xs text-gray-500">Realizado: R$ 0,00</p>
                    </div>

                    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-medium text-gray-700">Total Despesas</h3>
                            <span class="text-red-600 text-xl">üìâ</span>
                        </div>
                        <div id="total-despesas" class="text-xl md:text-2xl font-bold text-red-600 mb-1">R$ 0,00</div>
                        <p id="despesas-realizadas" class="text-xs text-gray-500">Realizado: R$ 0,00</p>
                    </div>

                    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-medium text-gray-700">Saldo Atual</h3>
                            <span class="text-blue-600 text-xl">üí∞</span>
                        </div>
                        <div id="saldo-atual" class="text-xl md:text-2xl font-bold mb-1">R$ 0,00</div>
                        <p id="saldo-previsto" class="text-xs text-gray-500">Previsto: R$ 0,00</p>
                    </div>
                </div>

                <!-- Previsto x Realizado -->
                <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold flex items-center gap-2 mb-2">
                            <span>üéØ</span>
                            Previsto x Realizado
                        </h3>
                        <p class="text-sm text-gray-600">Compare seus valores planejados com os realizados</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-green-600 mb-3">üíö Receitas</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Previsto:</span>
                                    <span id="receitas-previsto" class="font-medium">R$ 0,00</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Realizado:</span>
                                    <span id="receitas-realizado" class="font-medium">R$ 0,00</span>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t">
                                    <span class="text-sm font-medium">Diferen√ßa:</span>
                                    <span id="receitas-diferenca" class="font-bold">R$ 0,00</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-red-600 mb-3">‚ù§Ô∏è Despesas</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Previsto:</span>
                                    <span id="despesas-previsto" class="font-medium">R$ 0,00</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Realizado:</span>
                                    <span id="despesas-realizado" class="font-medium">R$ 0,00</span>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t">
                                    <span class="text-sm font-medium">Diferen√ßa:</span>
                                    <span id="despesas-diferenca" class="font-bold">R$ 0,00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Categorias -->
                <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4">
                        <div>
                            <h3 class="text-lg font-semibold">üè∑Ô∏è Categorias</h3>
                            <p class="text-sm text-gray-600">Gerencie suas categorias de receitas e despesas</p>
                        </div>
                        <button onclick="openModal('modal-categoria')" class="bg-blue-600 text-white hover:bg-blue-700 py-2 px-4 rounded-md text-sm font-medium flex items-center justify-center gap-2 w-full md:w-auto">
                            <span>‚ûï</span>
                            Nova Categoria
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-green-600 mb-3">üíö Receitas</h4>
                            <div id="categorias-receitas" class="flex flex-wrap gap-2"></div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-red-600 mb-3">‚ù§Ô∏è Despesas</h4>
                            <div id="categorias-despesas" class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Extrato Tab -->
            <div id="extrato" class="tab-content space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Gr√°fico de Pizza -->
                    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold">ü•ß Distribui√ß√£o de Despesas</h3>
                            <p class="text-sm text-gray-600">Visualize como suas despesas est√£o distribu√≠das por categoria</p>
                        </div>
                        <div class="chart-container">
                            <canvas id="grafico-pizza"></canvas>
                        </div>
                    </div>

                    <!-- Gr√°fico de Barras -->
                    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold">üìä Previsto vs Realizado</h3>
                            <p class="text-sm text-gray-600">Compare valores previstos e realizados por categoria</p>
                        </div>
                        <div class="chart-container">
                            <canvas id="grafico-barras"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Lista de Transa√ß√µes -->
                <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold">üìù Hist√≥rico de Transa√ß√µes</h3>
                        <p class="text-sm text-gray-600">Visualize todas as suas transa√ß√µes</p>
                    </div>
                    <div id="lista-transacoes" class="space-y-3"></div>
                </div>
            </div>

            <!-- Contas Tab -->
            <div id="contas" class="tab-content">
                <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 md:p-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4">
                        <div>
                            <h3 class="text-lg font-semibold">üìã Gerenciar Contas</h3>
                            <p class="text-sm text-gray-600">Adicione e gerencie suas contas com datas de vencimento</p>
                        </div>
                        <button onclick="openModal('modal-conta')" class="bg-blue-600 text-white hover:bg-blue-700 py-2 px-4 rounded-md text-sm font-medium flex items-center justify-center gap-2 w-full md:w-auto">
                            <span>‚ûï</span>
                            Nova Conta
                        </button>
                    </div>
                    <div id="lista-contas" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Configura√ß√£o -->
    <div id="modal-configuracao" class="modal fixed inset-0 z-50 bg-black bg-opacity-50 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-lg">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">‚öôÔ∏è Configura√ß√µes do Google Sheets</h2>
                    <button onclick="closeModal('modal-configuracao')" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">URL do Google Apps Script</label>
                        <input id="config-script-url" type="url" placeholder="https://script.google.com/macros/s/..." class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Cole aqui a URL do seu Google Apps Script</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ID da Planilha</label>
                        <input id="config-sheet-id" type="text" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms" class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">ID da sua planilha do Google Sheets</p>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-2">üìã Como configurar:</h4>
                        <ol class="text-sm text-blue-700 space-y-1 list-decimal list-inside">
                            <li>Crie uma planilha no Google Sheets</li>
                            <li>V√° em Extens√µes ‚Üí Apps Script</li>
                            <li>Cole o c√≥digo fornecido no arquivo README</li>
                            <li>Publique como aplicativo web</li>
                            <li>Cole a URL aqui</li>
                        </ol>
                    </div>
                    <div class="flex gap-2 pt-4">
                        <button onclick="salvarConfiguracao()" class="flex-1 bg-blue-600 text-white hover:bg-blue-700 py-2 px-4 rounded-md text-sm font-medium">
                            Salvar
                        </button>
                        <button onclick="testarConexao()" class="flex-1 bg-green-600 text-white hover:bg-green-700 py-2 px-4 rounded-md text-sm font-medium">
                            Testar Conex√£o
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Categoria -->
    <div id="modal-categoria" class="modal fixed inset-0 z-50 bg-black bg-opacity-50 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">‚ûï Adicionar Nova Categoria</h2>
                    <button onclick="closeModal('modal-categoria')" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Nome da Categoria</label>
                        <input id="categoria-nome" type="text" placeholder="Ex: Educa√ß√£o" class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Tipo</label>
                        <select id="categoria-tipo" class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="receita">üíö Receita</option>
                            <option value="despesa">‚ù§Ô∏è Despesa</option>
                        </select>
                    </div>
                    <div class="flex gap-2 pt-4">
                        <button onclick="adicionarCategoria()" class="flex-1 bg-blue-600 text-white hover:bg-blue-700 py-2 px-4 rounded-md text-sm font-medium">
                            Adicionar
                        </button>
                        <button onclick="closeModal('modal-categoria')" class="flex-1 border border-gray-300 bg-white hover:bg-gray-50 py-2 px-4 rounded-md text-sm font-medium">
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova/Editar Conta -->
    <div id="modal-conta" class="modal fixed inset-0 z-50 bg-black bg-opacity-50 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="modal-conta-titulo" class="text-lg font-semibold">‚ûï Adicionar Nova Conta</h2>
                    <button onclick="closeModal('modal-conta')" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Categoria</label>
                        <select id="conta-categoria" class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Selecione uma categoria</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Valor (R$)</label>
                        <input id="conta-valor" type="number" step="0.01" placeholder="0,00" class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Tipo</label>
                        <select id="conta-tipo" class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="receita">üíö Receita</option>
                            <option value="despesa">‚ù§Ô∏è Despesa</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Descri√ß√£o</label>
                        <input id="conta-descricao" type="text" placeholder="Descri√ß√£o da conta" class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Data de Vencimento</label>
                        <input id="conta-vencimento" type="date" class="w-full h-10 rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex gap-2 pt-4">
                        <button id="btn-salvar-conta" onclick="salvarConta()" class="flex-1 bg-blue-600 text-white hover:bg-blue-700 py-2 px-4 rounded-md text-sm font-medium">
                            Adicionar
                        </button>
                        <button onclick="closeModal('modal-conta')" class="flex-1 border border-gray-300 bg-white hover:bg-gray-50 py-2 px-4 rounded-md text-sm font-medium">
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o de Exclus√£o -->
    <div id="modal-confirmar-exclusao" class="modal fixed inset-0 z-50 bg-black bg-opacity-50 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-red-600">üóëÔ∏è Confirmar Exclus√£o</h2>
                    <button onclick="closeModal('modal-confirmar-exclusao')" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                </div>
                <div class="mb-6">
                    <p class="text-gray-700">Tem certeza que deseja excluir esta conta?</p>
                    <p id="conta-para-excluir" class="font-semibold text-gray-900 mt-2"></p>
                </div>
                <div class="flex gap-2">
                    <button id="btn-confirmar-exclusao" class="flex-1 bg-red-600 text-white hover:bg-red-700 py-2 px-4 rounded-md text-sm font-medium">
                        Sim, Excluir
                    </button>
                    <button onclick="closeModal('modal-confirmar-exclusao')" class="flex-1 border border-gray-300 bg-white hover:bg-gray-50 py-2 px-4 rounded-md text-sm font-medium">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Verificar se Chart.js foi carregado
        if (typeof Chart === 'undefined') {
            console.error('Chart.js n√£o foi carregado. Verifique a conex√£o com a internet.');
        }

        // Configura√ß√µes do Google Sheets
        let config = {
            scriptUrl: '',
            sheetId: ''
        };

        // Dados globais
        let categorias = [
            { id: "1", nome: "Moradia", tipo: "despesa" },
            { id: "2", nome: "Lazer", tipo: "despesa" },
            { id: "3", nome: "Transporte", tipo: "despesa" },
            { id: "4", nome: "Alimenta√ß√£o", tipo: "despesa" },
            { id: "5", nome: "Sa√∫de", tipo: "despesa" },
            { id: "6", nome: "Outros", tipo: "despesa" },
            { id: "7", nome: "Sal√°rio", tipo: "receita" },
            { id: "8", nome: "Freelance", tipo: "receita" },
        ];

        let itensOrcamento = [
            { id: "1", categoria: "Sal√°rio", valor: 5000, tipo: "receita", status: "realizado", descricao: "Sal√°rio mensal" },
            { id: "2", categoria: "Freelance", valor: 1500, tipo: "receita", status: "previsto", dataVencimento: "2025-01-15", descricao: "Projeto freelance" },
            { id: "3", categoria: "Moradia", valor: 1200, tipo: "despesa", status: "realizado", dataVencimento: "2025-01-10", descricao: "Aluguel" },
            { id: "4", categoria: "Alimenta√ß√£o", valor: 800, tipo: "despesa", status: "realizado", descricao: "Supermercado" },
            { id: "5", categoria: "Transporte", valor: 400, tipo: "despesa", status: "previsto", dataVencimento: "2025-01-12", descricao: "Combust√≠vel" },
            { id: "6", categoria: "Lazer", valor: 300, tipo: "despesa", status: "previsto", dataVencimento: "2025-01-20", descricao: "Cinema e restaurantes" },
            { id: "7", categoria: "Sa√∫de", valor: 250, tipo: "despesa", status: "previsto", dataVencimento: "2025-01-11", descricao: "Plano de sa√∫de" },
        ];

        let graficoPizza = null;
        let graficoBarras = null;
        let contaEditando = null;
        let contaParaExcluir = null;

        // Fun√ß√µes de Google Sheets
        function mostrarStatus(mensagem, tipo = 'loading') {
            const statusElement = document.getElementById('sync-status');
            statusElement.style.display = 'block';
            statusElement.className = `sync-status ${tipo}`;
            
            if (tipo === 'loading') {
                statusElement.innerHTML = `<span class="loading-spinner"></span> ${mensagem}`;
            } else {
                statusElement.textContent = mensagem;
            }
            
            if (tipo !== 'loading') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 3000);
            }
        }

        function salvarConfiguracao() {
            const scriptUrl = document.getElementById('config-script-url').value.trim();
            const sheetId = document.getElementById('config-sheet-id').value.trim();
            
            if (scriptUrl && sheetId) {
                config.scriptUrl = scriptUrl;
                config.sheetId = sheetId;
                
                localStorage.setItem('orcamento-config', JSON.stringify(config));
                closeModal('modal-configuracao');
                mostrarStatus('Configura√ß√£o salva com sucesso!', 'success');
            } else {
                alert('Por favor, preencha todos os campos de configura√ß√£o.');
            }
        }

        function carregarConfiguracao() {
            try {
                const configStorage = localStorage.getItem('orcamento-config');
                if (configStorage) {
                    config = JSON.parse(configStorage);
                    document.getElementById('config-script-url').value = config.scriptUrl || '';
                    document.getElementById('config-sheet-id').value = config.sheetId || '';
                }
            } catch (e) {
                console.error('Erro ao carregar configura√ß√£o:', e);
            }
        }

        async function testarConexao() {
            const scriptUrl = document.getElementById('config-script-url').value.trim();
            
            if (!scriptUrl) {
                alert('Por favor, configure a URL do Google Apps Script primeiro.');
                return;
            }
            
            mostrarStatus('Testando conex√£o...', 'loading');
            
            try {
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'test'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        mostrarStatus('Conex√£o estabelecida com sucesso!', 'success');
                    } else {
                        mostrarStatus('Erro na conex√£o: ' + result.error, 'error');
                    }
                } else {
                    mostrarStatus('Erro na conex√£o com o servidor', 'error');
                }
            } catch (error) {
                console.error('Erro ao testar conex√£o:', error);
                mostrarStatus('Erro ao conectar com Google Sheets', 'error');
            }
        }

        async function sincronizarDados() {
            if (!config.scriptUrl || !config.sheetId) {
                alert('Por favor, configure o Google Sheets primeiro.');
                openModal('modal-configuracao');
                return;
            }
            
            mostrarStatus('Sincronizando dados...', 'loading');
            
            try {
                const dadosParaEnviar = {
                    action: 'sync',
                    sheetId: config.sheetId,
                    categorias: categorias,
                    itens: itensOrcamento,
                    timestamp: new Date().toISOString()
                };
                
                const response = await fetch(config.scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dadosParaEnviar)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        mostrarStatus('Dados sincronizados com sucesso!', 'success');
                        
                        // Se houver dados retornados do servidor, atualizar localmente
                        if (result.data) {
                            if (result.data.categorias) {
                                categorias = result.data.categorias;
                            }
                            if (result.data.itens) {
                                itensOrcamento = result.data.itens;
                            }
                            atualizarInterface();
                            salvarDados();
                        }
                    } else {
                        mostrarStatus('Erro na sincroniza√ß√£o: ' + result.error, 'error');
                    }
                } else {
                    mostrarStatus('Erro na sincroniza√ß√£o', 'error');
                }
            } catch (error) {
                console.error('Erro ao sincronizar:', error);
                mostrarStatus('Erro ao sincronizar com Google Sheets', 'error');
            }
        }

        // Fun√ß√µes utilit√°rias
        function formatarMoeda(valor) {
            return new Intl.NumberFormat("pt-BR", {
                style: "currency",
                currency: "BRL",
            }).format(valor);
        }

        function formatarData(dataString) {
            if (!dataString) return '';
            const data = new Date(dataString);
            return data.toLocaleDateString('pt-BR');
        }

        function diferencaEmDias(dataString) {
            if (!dataString) return 999;
            const data = new Date(dataString);
            const hoje = new Date();
            const diffTime = data.getTime() - hoje.getTime();
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Fun√ß√µes de navega√ß√£o
        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover classe active de todos os bot√µes
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            const tabElement = document.getElementById(tabName);
            if (tabElement) {
                tabElement.classList.add('active');
            }
            
            // Adicionar classe active ao bot√£o clicado
            event.target.classList.add('active');
            
            // Atualizar gr√°ficos se for a aba extrato
            if (tabName === 'extrato') {
                setTimeout(() => {
                    atualizarGraficos();
                }, 100);
            }
        }

        // Fun√ß√µes de modal
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                if (modalId === 'modal-conta') {
                    atualizarSelectCategorias();
                } else if (modalId === 'modal-configuracao') {
                    carregarConfiguracao();
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                // Limpar campos
                if (modalId === 'modal-categoria') {
                    document.getElementById('categoria-nome').value = '';
                    document.getElementById('categoria-tipo').value = 'despesa';
                } else if (modalId === 'modal-conta') {
                    limparFormularioConta();
                }
            }
        }

        function limparFormularioConta() {
            document.getElementById('conta-categoria').value = '';
            document.getElementById('conta-valor').value = '';
            document.getElementById('conta-tipo').value = 'despesa';
            document.getElementById('conta-descricao').value = '';
            document.getElementById('conta-vencimento').value = '';
            contaEditando = null;
            
            // Resetar t√≠tulo e bot√£o
            document.getElementById('modal-conta-titulo').textContent = '‚ûï Adicionar Nova Conta';
            document.getElementById('btn-salvar-conta').textContent = 'Adicionar';
        }

        // Fun√ß√µes de dados
        async function adicionarCategoria() {
            const nome = document.getElementById('categoria-nome').value.trim();
            const tipo = document.getElementById('categoria-tipo').value;
            
            if (nome) {
                const nova = {
                    id: Date.now().toString(),
                    nome: nome,
                    tipo: tipo
                };
                categorias.push(nova);
                closeModal('modal-categoria');
                atualizarInterface();
                salvarDados();
                
                // Sincronizar automaticamente se configurado
                if (config.scriptUrl && config.sheetId) {
                    await sincronizarDados();
                }
            } else {
                alert('Por favor, digite o nome da categoria.');
            }
        }

        async function salvarConta() {
            const categoria = document.getElementById('conta-categoria').value;
            const valor = parseFloat(document.getElementById('conta-valor').value);
            const tipo = document.getElementById('conta-tipo').value;
            const descricao = document.getElementById('conta-descricao').value;
            const vencimento = document.getElementById('conta-vencimento').value;
            
            if (categoria && valor > 0) {
                if (contaEditando) {
                    // Editando conta existente
                    const index = itensOrcamento.findIndex(item => item.id === contaEditando);
                    if (index !== -1) {
                        itensOrcamento[index] = {
                            ...itensOrcamento[index],
                            categoria: categoria,
                            valor: valor,
                            tipo: tipo,
                            descricao: descricao,
                            dataVencimento: vencimento
                        };
                    }
                } else {
                    // Adicionando nova conta
                    const nova = {
                        id: Date.now().toString(),
                        categoria: categoria,
                        valor: valor,
                        tipo: tipo,
                        status: "previsto",
                        dataVencimento: vencimento,
                        descricao: descricao
                    };
                    itensOrcamento.push(nova);
                }
                
                closeModal('modal-conta');
                atualizarInterface();
                salvarDados();
                
                // Sincronizar automaticamente se configurado
                if (config.scriptUrl && config.sheetId) {
                    await sincronizarDados();
                }
            } else {
                alert('Por favor, preencha a categoria e o valor.');
            }
        }

        function editarConta(id) {
            const conta = itensOrcamento.find(item => item.id === id);
            if (conta) {
                contaEditando = id;
                
                // Preencher formul√°rio
                document.getElementById('conta-categoria').value = conta.categoria;
                document.getElementById('conta-valor').value = conta.valor;
                document.getElementById('conta-tipo').value = conta.tipo;
                document.getElementById('conta-descricao').value = conta.descricao || '';
                document.getElementById('conta-vencimento').value = conta.dataVencimento || '';
                
                // Alterar t√≠tulo e bot√£o
                document.getElementById('modal-conta-titulo').textContent = '‚úèÔ∏è Editar Conta';
                document.getElementById('btn-salvar-conta').textContent = 'Salvar';
                
                openModal('modal-conta');
            }
        }

        function confirmarExclusao(id) {
            const conta = itensOrcamento.find(item => item.id === id);
            if (conta) {
                contaParaExcluir = id;
                document.getElementById('conta-para-excluir').textContent = 
                    `${conta.categoria} - ${formatarMoeda(conta.valor)}`;
                
                document.getElementById('btn-confirmar-exclusao').onclick = () => excluirConta(id);
                openModal('modal-confirmar-exclusao');
            }
        }

        async function excluirConta(id) {
            itensOrcamento = itensOrcamento.filter(item => item.id !== id);
            closeModal('modal-confirmar-exclusao');
            atualizarInterface();
            salvarDados();
            
            // Sincronizar automaticamente se configurado
            if (config.scriptUrl && config.sheetId) {
                await sincronizarDados();
            }
        }

        async function toggleStatusConta(id) {
            const index = itensOrcamento.findIndex(item => item.id === id);
            if (index !== -1) {
                itensOrcamento[index].status = itensOrcamento[index].status === 'realizado' ? 'previsto' : 'realizado';
                atualizarInterface();
                salvarDados();
                
                // Sincronizar automaticamente se configurado
                if (config.scriptUrl && config.sheetId) {
                    await sincronizarDados();
                }
            }
        }

        function atualizarSelectCategorias() {
            const select = document.getElementById('conta-categoria');
            if (select) {
                select.innerHTML = '<option value="">Selecione uma categoria</option>';
                
                categorias.forEach(categoria => {
                    const option = document.createElement('option');
                    option.value = categoria.nome;
                    option.textContent = `${categoria.nome} (${categoria.tipo})`;
                    select.appendChild(option);
                });
            }
        }

        // Fun√ß√µes de c√°lculo
        function calcularResumo() {
            const receitasRealizadas = itensOrcamento
                .filter(item => item.tipo === "receita" && item.status === "realizado")
                .reduce((total, item) => total + item.valor, 0);

            const receitasPrevistas = itensOrcamento
                .filter(item => item.tipo === "receita" && item.status === "previsto")
                .reduce((total, item) => total + item.valor, 0);

            const despesasRealizadas = itensOrcamento
                .filter(item => item.tipo === "despesa" && item.status === "realizado")
                .reduce((total, item) => total + item.valor, 0);

            const despesasPrevistas = itensOrcamento
                .filter(item => item.tipo === "despesa" && item.status === "previsto")
                .reduce((total, item) => total + item.valor, 0);

            const totalReceitas = receitasRealizadas + receitasPrevistas;
            const totalDespesas = despesasRealizadas + despesasPrevistas;
            const saldoAtual = receitasRealizadas - despesasRealizadas;
            const saldoPrevisto = totalReceitas - totalDespesas;

            return {
                receitasRealizadas,
                receitasPrevistas,
                despesasRealizadas,
                despesasPrevistas,
                totalReceitas,
                totalDespesas,
                saldoAtual,
                saldoPrevisto
            };
        }

        function obterAlertasVencimento() {
            return itensOrcamento.filter(item => {
                if (!item.dataVencimento || item.status === "realizado") return false;
                const diasParaVencimento = diferencaEmDias(item.dataVencimento);
                return diasParaVencimento <= 1 && diasParaVencimento >= 0;
            });
        }

        // Fun√ß√µes de interface
        function atualizarResumo() {
            const resumo = calcularResumo();
            
            const elementos = {
                'total-receitas': formatarMoeda(resumo.totalReceitas),
                'receitas-realizadas': `Realizado: ${formatarMoeda(resumo.receitasRealizadas)}`,
                'total-despesas': formatarMoeda(resumo.totalDespesas),
                'despesas-realizadas': `Realizado: ${formatarMoeda(resumo.despesasRealizadas)}`,
                'saldo-previsto': `Previsto: ${formatarMoeda(resumo.saldoPrevisto)}`,
                'receitas-previsto': formatarMoeda(resumo.totalReceitas),
                'receitas-realizado': formatarMoeda(resumo.receitasRealizadas),
                'despesas-previsto': formatarMoeda(resumo.totalDespesas),
                'despesas-realizado': formatarMoeda(resumo.despesasRealizadas)
            };

            Object.entries(elementos).forEach(([id, valor]) => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.textContent = valor;
                }
            });
            
            // Saldo atual com cor
            const saldoElement = document.getElementById('saldo-atual');
            if (saldoElement) {
                saldoElement.textContent = formatarMoeda(resumo.saldoAtual);
                saldoElement.className = `text-xl md:text-2xl font-bold mb-1 ${resumo.saldoAtual >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            
            // Diferen√ßas com cores
            const receitasDiff = resumo.receitasRealizadas - resumo.totalReceitas;
            const receitasDiffElement = document.getElementById('receitas-diferenca');
            if (receitasDiffElement) {
                receitasDiffElement.textContent = formatarMoeda(receitasDiff);
                receitasDiffElement.className = `font-bold ${receitasDiff >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            
            const despesasDiff = resumo.despesasRealizadas - resumo.totalDespesas;
            const despesasDiffElement = document.getElementById('despesas-diferenca');
            if (despesasDiffElement) {
                despesasDiffElement.textContent = formatarMoeda(despesasDiff);
                despesasDiffElement.className = `font-bold ${despesasDiff <= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
        }

        function atualizarCategorias() {
            const receitasContainer = document.getElementById('categorias-receitas');
            const despesasContainer = document.getElementById('categorias-despesas');
            
            if (receitasContainer) receitasContainer.innerHTML = '';
            if (despesasContainer) despesasContainer.innerHTML = '';
            
            categorias.forEach(categoria => {
                const badge = document.createElement('span');
                badge.className = 'inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold border-gray-300 text-gray-900 bg-white';
                badge.textContent = categoria.nome;
                
                if (categoria.tipo === 'receita' && receitasContainer) {
                    receitasContainer.appendChild(badge);
                } else if (categoria.tipo === 'despesa' && despesasContainer) {
                    despesasContainer.appendChild(badge);
                }
            });
        }

        function atualizarAlertas() {
            const alertas = obterAlertasVencimento();
            const container = document.getElementById('alertas-container');
            const lista = document.getElementById('alertas-lista');
            
            if (container && lista) {
                if (alertas.length > 0) {
                    container.classList.remove('hidden');
                    lista.innerHTML = '';
                    
                    alertas.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'flex justify-between items-center';
                        div.innerHTML = `
                            <span>${item.descricao || item.categoria}</span>
                            <span class="font-medium">${formatarData(item.dataVencimento)} - ${formatarMoeda(item.valor)}</span>
                        `;
                        lista.appendChild(div);
                    });
                } else {
                    container.classList.add('hidden');
                }
            }
        }

        function atualizarTransacoes() {
            const container = document.getElementById('lista-transacoes');
            if (!container) return;
            
            container.innerHTML = '';
            
            itensOrcamento.forEach(item => {
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-3 border rounded-lg ${item.status === 'realizado' ? 'item-pago' : ''}`;
                
                const statusIcon = item.status === 'realizado' ? '‚úÖ' : 'üéØ';
                const valorColor = item.tipo === 'receita' ? 'text-green-600' : 'text-red-600';
                const sinal = item.tipo === 'receita' ? '+' : '-';
                
                let vencimentoInfo = '';
                if (item.dataVencimento) {
                    vencimentoInfo = `<p class="text-xs text-gray-500 flex items-center gap-1">
                        <span>üïê</span>
                        Vence em: ${formatarData(item.dataVencimento)}
                    </p>`;
                }
                
                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="checkbox-container" onclick="toggleStatusConta('${item.id}')">
                            <div class="checkbox-custom ${item.status === 'realizado' ? 'checked' : ''}">
                                ${item.status === 'realizado' ? '‚úì' : ''}
                            </div>
                        </div>
                        <span class="text-lg">${statusIcon}</span>
                        <div>
                            <div class="flex items-center gap-2 flex-wrap">
                                <span class="font-medium ${item.status === 'realizado' ? 'item-titulo' : ''}">${item.categoria}</span>
                                <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold ${item.status === 'realizado' ? 'border-transparent bg-green-600 text-white' : 'border-transparent bg-gray-100 text-gray-900'}">
                                    ${item.status === 'realizado' ? 'pago' : 'pendente'}
                                </span>
                            </div>
                            ${item.descricao ? `<p class="text-sm text-gray-600 ${item.status === 'realizado' ? 'item-titulo' : ''}">${item.descricao}</p>` : ''}
                            ${vencimentoInfo}
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="font-bold ${valorColor}">
                            ${sinal}${formatarMoeda(item.valor)}
                        </span>
                        <div class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editarConta('${item.id}')" title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button class="btn-small btn-delete" onclick="confirmarExclusao('${item.id}')" title="Excluir">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function atualizarContas() {
            const container = document.getElementById('lista-contas');
            if (!container) return;
            
            container.innerHTML = '';
            
            const contasComVencimento = itensOrcamento
                .filter(item => item.dataVencimento)
                .sort((a, b) => new Date(a.dataVencimento) - new Date(b.dataVencimento));
            
            contasComVencimento.forEach(item => {
                const diasParaVencimento = diferencaEmDias(item.dataVencimento);
                const isVencimentoProximo = diasParaVencimento <= 1 && diasParaVencimento >= 0;
                
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-3 border rounded-lg ${isVencimentoProximo ? 'border-orange-300 bg-orange-50' : ''} ${item.status === 'realizado' ? 'item-pago' : ''}`;
                
                const statusIcon = item.status === 'realizado' ? '‚úÖ' : 'üïê';
                const valorColor = item.tipo === 'receita' ? 'text-green-600' : 'text-red-600';
                const sinal = item.tipo === 'receita' ? '+' : '-';
                
                let alertaVencimento = '';
                if (isVencimentoProximo && item.status !== 'realizado') {
                    const textoVencimento = diasParaVencimento === 0 ? 'hoje' : 'amanh√£';
                    alertaVencimento = `<span class="inline-flex items-center rounded-full border-transparent bg-red-600 text-white px-2.5 py-0.5 text-xs font-semibold">
                        Vence ${textoVencimento}
                    </span>`;
                }
                
                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="checkbox-container" onclick="toggleStatusConta('${item.id}')">
                            <div class="checkbox-custom ${item.status === 'realizado' ? 'checked' : ''}">
                                ${item.status === 'realizado' ? '‚úì' : ''}
                            </div>
                        </div>
                        ${isVencimentoProximo && item.status !== 'realizado' ? '<span class="text-orange-600 text-lg">‚ö†Ô∏è</span>' : ''}
                        <span class="text-lg">${statusIcon}</span>
                        <div>
                            <div class="flex items-center gap-2 flex-wrap">
                                <span class="font-medium ${item.status === 'realizado' ? 'item-titulo' : ''}">${item.categoria}</span>
                                <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold ${item.status === 'realizado' ? 'border-transparent bg-green-600 text-white' : 'border-transparent bg-gray-100 text-gray-900'}">
                                    ${item.status === 'realizado' ? 'pago' : 'pendente'}
                                </span>
                                ${alertaVencimento}
                            </div>
                            ${item.descricao ? `<p class="text-sm text-gray-600 ${item.status === 'realizado' ? 'item-titulo' : ''}">${item.descricao}</p>` : ''}
                            <p class="text-xs text-gray-500 flex items-center gap-1">
                                <span>üìÖ</span>
                                ${formatarData(item.dataVencimento)}
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="font-bold ${valorColor}">
                            ${sinal}${formatarMoeda(item.valor)}
                        </span>
                        <div class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editarConta('${item.id}')" title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button class="btn-small btn-delete" onclick="confirmarExclusao('${item.id}')" title="Excluir">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function atualizarGraficos() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js n√£o est√° dispon√≠vel');
                return;
            }

            // Dados para gr√°fico de pizza
            const dadosPizza = {};
            itensOrcamento
                .filter(item => item.tipo === 'despesa')
                .forEach(item => {
                    if (dadosPizza[item.categoria]) {
                        dadosPizza[item.categoria] += item.valor;
                    } else {
                        dadosPizza[item.categoria] = item.valor;
                    }
                });
            
            const labelsPizza = Object.keys(dadosPizza);
            const valuesPizza = Object.values(dadosPizza);
            const coresPizza = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
            ];
            
            // Destruir gr√°fico anterior se existir
            if (graficoPizza) {
                graficoPizza.destroy();
            }
            
            // Criar gr√°fico de pizza
            const ctxPizza = document.getElementById('grafico-pizza');
            if (ctxPizza) {
                graficoPizza = new Chart(ctxPizza, {
                    type: 'pie',
                    data: {
                        labels: labelsPizza,
                        datasets: [{
                            data: valuesPizza,
                            backgroundColor: coresPizza.slice(0, labelsPizza.length),
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.raw / total) * 100).toFixed(1);
                                        return context.label + ': ' + formatarMoeda(context.raw) + ' (' + percentage + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Dados para gr√°fico de barras
            const dadosBarras = {};
            categorias.forEach(categoria => {
                const previsto = itensOrcamento
                    .filter(item => item.categoria === categoria.nome && item.status === 'previsto')
                    .reduce((sum, item) => sum + item.valor, 0);
                
                const realizado = itensOrcamento
                    .filter(item => item.categoria === categoria.nome && item.status === 'realizado')
                    .reduce((sum, item) => sum + item.valor, 0);
                
                if (previsto > 0 || realizado > 0) {
                    dadosBarras[categoria.nome] = { previsto, realizado };
                }
            });
            
            const labelsBarras = Object.keys(dadosBarras);
            const previstoData = labelsBarras.map(label => dadosBarras[label].previsto);
            const realizadoData = labelsBarras.map(label => dadosBarras[label].realizado);
            
            // Destruir gr√°fico anterior se existir
            if (graficoBarras) {
                graficoBarras.destroy();
            }
            
            // Criar gr√°fico de barras
            const ctxBarras = document.getElementById('grafico-barras');
            if (ctxBarras) {
                graficoBarras = new Chart(ctxBarras, {
                    type: 'bar',
                    data: {
                        labels: labelsBarras,
                        datasets: [
                            {
                                label: 'Previsto',
                                data: previstoData,
                                backgroundColor: '#8884d8',
                                borderColor: '#8884d8',
                                borderWidth: 1
                            },
                            {
                                label: 'Realizado',
                                data: realizadoData,
                                backgroundColor: '#82ca9d',
                                borderColor: '#82ca9d',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + formatarMoeda(context.raw);
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Fun√ß√µes de persist√™ncia
        function salvarDados() {
            try {
                localStorage.setItem('orcamento-categorias', JSON.stringify(categorias));
                localStorage.setItem('orcamento-itens', JSON.stringify(itensOrcamento));
            } catch (e) {
                console.error('Erro ao salvar dados:', e);
            }
        }

        function carregarDados() {
            try {
                const categoriasStorage = localStorage.getItem('orcamento-categorias');
                const itensStorage = localStorage.getItem('orcamento-itens');
                
                if (categoriasStorage) {
                    categorias = JSON.parse(categoriasStorage);
                }
                
                if (itensStorage) {
                    itensOrcamento = JSON.parse(itensStorage);
                }
            } catch (e) {
                console.error('Erro ao carregar dados:', e);
            }
        }

        function atualizarInterface() {
            atualizarResumo();
            atualizarCategorias();
            atualizarAlertas();
            atualizarTransacoes();
            atualizarContas();
        }

        // Fechar modal ao clicar fora
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                const modalId = event.target.id;
                closeModal(modalId);
            }
        });

        // Inicializar aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Aplica√ß√£o iniciada');
            carregarDados();
            carregarConfiguracao();
            atualizarInterface();
            
            // Verificar se Chart.js foi carregado
            if (typeof Chart !== 'undefined') {
                console.log('Chart.js carregado com sucesso');
            } else {
                console.error('Chart.js n√£o foi carregado');
            }
        });

        // Atualizar alertas a cada minuto
        setInterval(atualizarAlertas, 60000);
    </script>
</body>
</html>
